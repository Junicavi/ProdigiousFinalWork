<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Three JS Test</title>
    <link rel="stylesheet" type="text/css" href="src/style.css">
</head>
<body>
    <div class="ButtonsContainer">
        <div class="OpenButtonsContainer">
        <button class="ButtonAnimation" onclick="changeDriverDoorState()">Open Driver Door</button>
        <button class="ButtonAnimation" onclick="changeCopilotDoorState()">Open Co-Pilot Door</button>
        <button class="ButtonAnimation" onclick="changeLeftDoorState()">Open Left Door</button>               
        <button class="ButtonAnimation" onclick="changeRightDoorState()">Open Right Door</button>
        <button class="ButtonAnimation" onclick="changeWheelsState()">Spin Wheels</button>                            
        <button class="ButtonAnimation" onclick="RotateFunction()">Look Around</button>
        </div>
    <div class="FullButtons">
    </div>
    </div>
    <script src="js/three.js"></script>
    <script src="js/ColladaLoader.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/threex.domevents.js"></script>
    <script>
        //SCENE SETUP
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        var controls = new THREE.OrbitControls( camera );
        var light = new THREE.AmbientLight( 0xffffff );
        var player = null;
        var maxLeftRotation  = 2.8;
        var maxRightRotation  = 0.37;
        var minRotation= -1.6;
        var driverDoorState = false;
        var copilotDoorState = false;
        var leftDoorState = false;
        var rightDoorState = false;
        var wheelsState = false;
        //CAMERA SETUP
        camera.position.y = 5;
        camera.position.z = 5;
        controls.minDistance = 3;
        controls.maxDistance = 5;
        controls.maxPolarAngle = Math.PI/2.1;
        controls.autoRotate = false;
        // SCENE SETUP //                
        scene.background = new THREE.Color (0x000000);
        // RENDERER //
        var renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(window.innerWidth,window.innerHeight);
        document.body.appendChild( renderer.domElement);
        // PLANE SETUP //
        var geometry = new THREE.PlaneGeometry(70,50);
        var texture = new THREE.TextureLoader().load('src/Images/Floor4.jpg');
        var material = new THREE.MeshBasicMaterial({map:texture});
        var plane = new THREE.Mesh(geometry, material);
        texture.wrapS = THREE.RepeatWrapping;
        texture.wrapT = THREE.RepeatWrapping;
        texture.repeat.set(40,40);
        plane.material.side = THREE.DoubleSide;
        plane.rotation.x = Math.PI/2;
        // ADDING ELEMENTS //
        scene.add(light);
        scene.add(plane);
        // MODEL LOADER //
        loader = new THREE.ColladaLoader();
        loader.load('Model2.dae',function colladaReady( collada ){

            player = collada.scene;
            for (var i=0; i < player.children.length; i++) {
                    function randomColor(){
                        var letters = '0123456789ABCDEF';
                        var color = '#';
                        for (var i = 0; i < 6; i++) {
                            color += letters[Math.floor(Math.random()*16)];
                        }
                    return color;
                }
                player.children[i].material= new THREE.MeshBasicMaterial({color:randomColor()});
            }
            scene.add( player );
        });
        // STATE SWITCHER
        var changeDriverDoorState = function () {
            driverDoorState = !driverDoorState;
            console.log(driverDoorState);
        }
        var changeCopilotDoorState = function () {
            copilotDoorState = !copilotDoorState;
            console.log(copilotDoorState);
        }
        var changeLeftDoorState = function () {
            leftDoorState = !leftDoorState;
            console.log(leftDoorState);
        }
        var changeRightDoorState = function () {
            rightDoorState = !rightDoorState;
            console.log(rightDoorState);
        }
        var changeWheelsState = function () {
            wheelsState = !wheelsState;
            console.log(wheelsState);
        }
        // ANIMATION TRIGGERS 
        var driverDoorTrigger = function () {
            if (player != null) {
                if (driverDoorState) {
                    if(player.children[13].rotation.z >= -maxLeftRotation ){
                        player.children[13].rotation.z += -0.01;
                        player.children[13].translateX(0.25);
                        console.log(player.children[13].rotation.z);
                    }
                }
                else {
                    if(player.children[13].rotation.z < minRotation ){
                        player.children[13].rotation.z += 0.01;
                        player.children[13].translateX(-0.25);
                        console.log(player.children[13].rotation.z); 
                    }
                }
            }
        }
        var copilotDoorTrigger = function () {
            if (player != null) {
                if (copilotDoorState) {
                    if(player.children[26].rotation.z < -maxRightRotation ){
                        player.children[26].rotation.z += 0.01;
                        player.children[26].translateX(-0.25);
                    }
                }
                else {
                    if(player.children[26].rotation.z > minRotation ){
                        player.children[26].rotation.z += -0.01;
                        player.children[26].translateX(0.25);
                    }   
                }
            }
        }        
        var leftDoorTrigger = function () {
            if (player != null) {
                if (leftDoorState) {
                    if(player.children[27].rotation.z > -maxLeftRotation ){
                        player.children[27].rotation.z += -0.01; //DRIVER DOOR
                        player.children[27].translateX(0.18);
                    }
                }
                else {
                    if(player.children[27].rotation.z < minRotation ){
                        player.children[27].rotation.z += 0.01; //DRIVER DOOR
                        player.children[27].translateX(-0.18);
                    }
                }
            }
        }
        var rightDoorTrigger = function () {
            if (player != null) {
                if (rightDoorState) {
                    if(player.children[29].rotation.z < -maxRightRotation ){
                        player.children[29].rotation.z += 0.01; //DRIVER DOOR
                        player.children[29].translateX(-0.18);  
                    }            
                }
                else {
                    if(player.children[29].rotation.z > minRotation ){
                        player.children[29].rotation.z += -0.01; //DRIVER DOOR
                        player.children[29].translateX(0.18);  
                    }            
                }
            }
        }          
        var wheelsTrigger = function () {
            if(player != null) {
                if(wheelsState) {
                    player.children[1].rotation.y += 1;
                    player.children[3].rotation.y += 1;
                    player.children[5].rotation.y += 1;
                    player.children[7].rotation.y += 1;
                }
                else {
                    player.children[1].rotation.y += 0;
                    player.children[3].rotation.y += 0;
                    player.children[5].rotation.y += 0;
                    player.children[7].rotation.y += 0;
                }
            }
        }
        //ON-OFF AUTO ROTATE FUNCTION
        var RotateFunction = function () {
            if(controls.autoRotate === true) {
                controls.autoRotate = false;
            }
            else {
                controls.autoRotate = true;
            }
        }

        //DISPLAY AND ANIMATE//
        var animate = function () {
            requestAnimationFrame (animate);
            controls.update();
            driverDoorTrigger();
            copilotDoorTrigger();
            leftDoorTrigger();
            rightDoorTrigger();
            wheelsTrigger();
            renderer.render( scene, camera );
        }
        animate();
    </script>
</body>
</html>